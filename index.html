<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NIM Elite - Stable 2026</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        :root { --bg: #020617; --card: #0f172a; --text: #f1f5f9; --accent: #60a5fa; --green: #10b981; --red: #ef4444; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); padding: 15px; margin: 0; }
        .section { background: var(--card); border-radius: 12px; padding: 20px; border: 1px solid #1e293b; margin-bottom: 15px; }
        
        /* STATUS INDICATOR */
        .status-bar { display: flex; align-items: center; gap: 8px; margin-bottom: 15px; font-family: monospace; font-size: 0.85em; }
        #status-dot { width: 10px; height: 10px; border-radius: 50%; background: var(--green); box-shadow: 0 0 8px var(--green); }
        .pulse { animation: pulse-animation 1s infinite; }
        @keyframes pulse-animation { 0% { opacity: 1; } 50% { opacity: 0.3; } 100% { opacity: 1; } }

        /* CHAT BUBBLES */
        .msgs { height: 500px; overflow-y: auto; padding: 10px; background: #010409; border-radius: 8px; margin-bottom: 15px; }
        .msg { margin-bottom: 20px; border-bottom: 1px solid #1e293b; padding-bottom: 10px; line-height: 1.6; }
        .msg-content code { background: #1e293b; color: #f87171; padding: 2px 5px; border-radius: 4px; }
        .msg-content pre { background: #000; padding: 12px; border-radius: 8px; overflow-x: auto; border: 1px solid #334155; }

        textarea { width: 100%; background: #020617; border: 1px solid #1e293b; color: white; padding: 12px; border-radius: 8px; height: 60px; font-size: 16px; }
        button { background: var(--accent); color: #020617; border: none; padding: 12px 25px; border-radius: 8px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

<div class="section">
    <div class="status-bar">
        <div id="status-dot"></div>
        <span id="status-text">MODEL READY</span>
        <span id="latency-val" style="margin-left:auto; color:var(--accent)">0ms</span>
    </div>

    <div class="msgs" id="chat-box"></div>

    <div style="display:flex; gap:10px;">
        <textarea id="user-input" placeholder="Ask anything..."></textarea>
        <button onclick="send()">SEND</button>
    </div>
</div>

<script>
    let logs = [];
    const dot = document.getElementById('status-dot');
    const stext = document.getElementById('status-text');

    function setStatus(state, msg) {
        dot.className = ''; 
        if(state === 'ready') { dot.style.background = 'var(--green)'; dot.style.boxShadow = '0 0 8px var(--green)'; stext.innerText = msg || 'MODEL READY'; }
        if(state === 'busy') { dot.style.background = 'var(--accent)'; dot.style.boxShadow = '0 0 8px var(--accent)'; dot.classList.add('pulse'); stext.innerText = msg || 'THINKING...'; }
        if(state === 'error') { dot.style.background = 'var(--red)'; dot.style.boxShadow = '0 0 8px var(--red)'; stext.innerText = msg || 'PROXY ERROR'; }
    }

    async function send() {
        const input = document.getElementById('user-input');
        if(!input.value) return;

        const userMsg = input.value;
        logs.push({role:'user', content: userMsg});
        let ai = {role:'assistant', content: '', lat: 0};
        logs.push(ai);
        input.value = '';
        render();

        setStatus('busy');
        const t0 = Date.now();

        try {
            const response = await fetch('YOUR_PROXY_URL_HERE/v1/chat/completions', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ model: "mistral-large-3", messages: logs.slice(0,-1), stream: true })
            });

            if (!response.ok) throw new Error(`HTTP ${response.status}`);

            const reader = response.body.getReader();
            const decoder = new TextDecoder();

            while (true) {
                const {done, value} = await reader.read();
                if (done) break;
                const chunk = decoder.decode(value);
                const lines = chunk.split('\n');
                for (let line of lines) {
                    if (line.startsWith('data: ') && line !== 'data: [DONE]') {
                        const json = JSON.parse(line.substring(6));
                        const text = json.choices[0].delta.content;
                        if (text) {
                            if (!ai.lat) { 
                                ai.lat = Date.now() - t0;
                                document.getElementById('latency-val').innerText = ai.lat + 'ms';
                            }
                            ai.content += text;
                            render();
                        }
                    }
                }
            }
            setStatus('ready');
        } catch (e) {
            setStatus('error', e.message);
            ai.content += `\n\n**[Connection Failed: ${e.message}]**`;
            render();
        }
    }

    function render() {
        const box = document.getElementById('chat-box');
        box.innerHTML = logs.map(l => `
            <div class="msg">
                <b style="color:var(--accent); font-size:0.8em;">${l.role.toUpperCase()}</b>
                <div class="msg-content">${marked.parse(l.content)}</div>
            </div>`).join('');
        box.scrollTop = box.scrollHeight;
    }
</script>
</body>
</html>
